{% extends 'base.html.twig' %}

{% block title %}Lost & Found {% endblock %}

{% block body %}
<!-- Hero Section -->
<section class="py-5 mt-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="display-4 fw-bold mb-4">
                    Lost something?<br>
                    <span class="gradient-text">Found something?</span>
                </h1>
                <p class="lead text-muted mb-4">
                    Our community platform helps reunite lost items with their owners. 
                    Simple, secure, and compassionate.
                </p>
                <div class="d-flex flex-wrap gap-3">
                    <a class="btn btn-primary" href="{{ app.user ? path('app_item_new') : path('app_login') }}">
                        Report Lost Item
                    </a>

                    <a class="btn btn-outline" href="{{ app.user ? path('app_dashboard') : path('app_login') }}">
                        Browse Items
                    </a>
                </div>
                
                <div class="row mt-5 pt-4">
                    <div class="col-md-4">
                        <div class="text-center">
                            <h3 class="fw-bold">{{ itemsReported }}+</h3>
                            <p class="text-muted">Items Reported</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <h3 class="fw-bold">{{ currentlyLostCount }}+</h3>
                            <p class="text-muted">Currently Lost</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-center">
                            <h3 class="fw-bold">{{ successfullyFound }}+</h3>
                            <p class="text-muted">Successfully Found</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card shadow-lg border-0 overflow-hidden">
                    <div class="card-body p-0">
                        <div class="position-relative">
                            <img src="https://images.unsplash.com/photo-1556742049-0cfed4f6a45d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" 
                                 class="img-fluid rounded-lg" 
                                 alt="Lost items reunited">
                            <div class="position-absolute bottom-0 start-0 p-4">
                                <span class="badge badge-success px-3 py-2">
                                    <i class="fas fa-check-circle me-1"></i>
                                    87% Success Rate
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- How It Works -->
<section class="py-5 bg-light" id="how-it-works">
    <div class="container">
        <h2 class="section-title">How It Works</h2>
        <div class="row g-4">
            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="rounded-circle bg-primary bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-4" 
                             style="width: 80px; height: 80px;">
                            <i class="fas fa-edit fa-2x text-primary"></i>
                        </div>
                        <h5 class="fw-bold mb-3">Report</h5>
                        <p class="text-muted">
                            Submit details about your lost item or something you found.
                            Add photos for better identification.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="rounded-circle bg-primary bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-4" 
                             style="width: 80px; height: 80px;">
                            <i class="fas fa-broadcast-tower fa-2x text-primary"></i>
                        </div>
                        <h5 class="fw-bold mb-3">Share</h5>
                        <p class="text-muted">
                            Your listing is shared with our community.
                            Get notifications when similar items are reported.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm">
                    <div class="card-body text-center p-4">
                        <div class="rounded-circle bg-primary bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-4" 
                             style="width: 80px; height: 80px;">
                            <i class="fas fa-handshake fa-2x text-primary"></i>
                        </div>
                        <h5 class="fw-bold mb-3">Reunite</h5>
                        <p class="text-muted">
                            Connect with the owner or finder.
                            We facilitate secure communication and item return.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Recent Items -->
<section class="py-5">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2 class="section-title mb-0" id="recent-listings">Recent Listings</h2>
            <a class="btn btn-outline" href="{{ app.user ? path('app_dashboard') : path('app_login') }}">
                View all
            </a>
        </div>
        
        <!-- Lost Items -->
        <h4 class="fw-bold mb-3 text-danger">
            <i class="fas fa-exclamation-circle me-2"></i>Recently Lost
        </h4>
        <div class="row g-4 mb-5">
            {% for item in lostItems|slice(0, 3) %}
            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm">
                    {% if item.image %}
                        <img src="{{ asset('uploads/' ~ item.image) }}" class="card-img-top" alt="{{ item.title }}" style="height: 200px; object-fit: cover;">
                    {% else %}
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                            <i class="fas fa-image fa-3x text-muted"></i>
                        </div>
                    {% endif %}
                    <div class="card-body d-flex flex-column">
                        <span class="badge badge-lost mb-2">Lost</span>
                        <h5 class="card-title fw-bold">{{ item.title }}</h5>
                        <p class="card-text text-muted">{{ item.description|slice(0, 80) }}...</p>
                        <div class="d-flex justify-content-between align-items-center mt-auto">
                            <small class="text-muted">
                                <i class="fas fa-map-marker-alt me-1"></i>{{ item.location }}
                            </small>
                            <small class="text-muted">{{ item.date|date('M d') }}</small>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top-0">
                        <button
                            type="button"
                            class="btn btn-sm btn-outline w-100"
                            data-bs-toggle="modal"
                            data-bs-target="#homeLostModal{{ item.id }}"
                        >
                            View Details
                        </button>
                    </div>
                </div>
            </div>

            {# Modal for this lost item #}
            <div class="modal fade" id="homeLostModal{{ item.id }}" tabindex="-1"
                 aria-labelledby="homeLostModalLabel{{ item.id }}" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content rounded-4">
                        <div class="modal-header">
                            <h5 class="modal-title" id="homeLostModalLabel{{ item.id }}">
                                {{ item.title }} – Lost
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                {% if item.image %}
                                    <div class="col-md-5 mb-3 mb-md-0">
                                        <img src="{{ asset('uploads/' ~ item.image) }}"
                                             alt="{{ item.title }}"
                                             class="img-fluid rounded-3">
                                    </div>
                                    <div class="col-md-7">
                                {% else %}
                                    <div class="col-12">
                                {% endif %}
                                        <p><strong>Location:</strong> {{ item.location }}</p>
                                        <p><strong>Date:</strong> {{ item.date ? item.date|date('Y-m-d') : 'N/A' }}</p>
                                        
                                        <p class="mb-2"><strong>Description:</strong></p>
                                        <p>{{ item.description }}</p>

                                        <hr>

                                        <p><strong>Contact phone:</strong> {{ item.contactPhone ?: 'N/A' }}</p>
                                        <p><strong>Contact email:</strong> {{ item.contactEmail ?: 'N/A' }}</p>
                                    </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-12">
                <div class="alert alert-light border text-center py-4">
                    <i class="fas fa-inbox fa-2x text-muted mb-3"></i>
                    <h5 class="text-muted">No lost items reported yet</h5>
                    <p class="mb-0">Be the first to report a lost item</p>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Found Items -->
        <h4 class="fw-bold mb-3 text-success">
            <i class="fas fa-check-circle me-2" id="recently-found"></i>Recently Found
        </h4>
        <div class="row g-4">
            {% for item in foundItems|slice(0, 3) %}
            <div class="col-md-4">
                <div class="card h-100 border-0 shadow-sm">
                    {% if item.image %}
                        <img src="{{ asset('uploads/' ~ item.image) }}" class="card-img-top" alt="{{ item.title }}" style="height: 200px; object-fit: cover;">
                    {% else %}
                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                            <i class="fas fa-image fa-3x text-muted"></i>
                        </div>
                    {% endif %}
                    <div class="card-body d-flex flex-column">
                        <span class="badge badge-found mb-2">Found</span>
                        <h5 class="card-title fw-bold">{{ item.title }}</h5>
                        <p class="card-text text-muted">{{ item.description|slice(0, 80) }}...</p>
                        <div class="d-flex justify-content-between align-items-center mt-auto">
                            <small class="text-muted">
                                <i class="fas fa-map-marker-alt me-1"></i>{{ item.location }}
                            </small>
                            <small class="text-muted">{{ item.date|date('M d') }}</small>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent border-top-0">
                        <button
                            type="button"
                            class="btn btn-sm btn-outline w-100"
                            data-bs-toggle="modal"
                            data-bs-target="#homeFoundModal{{ item.id }}"
                        >
                            View Details
                        </button>
                    </div>
                </div>
            </div>

            {# Modal for this found item #}
            <div class="modal fade" id="homeFoundModal{{ item.id }}" tabindex="-1"
                 aria-labelledby="homeFoundModalLabel{{ item.id }}" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content rounded-4">
                        <div class="modal-header">
                            <h5 class="modal-title" id="homeFoundModalLabel{{ item.id }}">
                                {{ item.title }} – Found
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                {% if item.image %}
                                    <div class="col-md-5 mb-3 mb-md-0">
                                        <img src="{{ asset('uploads/' ~ item.image) }}"
                                             alt="{{ item.title }}"
                                             class="img-fluid rounded-3">
                                    </div>
                                    <div class="col-md-7">
                                {% else %}
                                    <div class="col-12">
                                {% endif %}
                                        <p><strong>Location:</strong> {{ item.location }}</p>
                                        <p><strong>Date:</strong> {{ item.date ? item.date|date('Y-m-d') : 'N/A' }}</p>
                                        
                                        <p class="mb-2"><strong>Description:</strong></p>
                                        <p>{{ item.description }}</p>

                                        <hr>

                                        <p><strong>Contact phone:</strong> {{ item.contactPhone ?: 'N/A' }}</p>
                                        <p><strong>Contact email:</strong> {{ item.contactEmail ?: 'N/A' }}</p>
                                    </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="col-12">
                <div class="alert alert-light border text-center py-4">
                    <i class="fas fa-inbox fa-2x text-muted mb-3"></i>
                    <h5 class="text-muted">No found items reported yet</h5>
                    <p class="mb-0">Found something? Help reunite it with its owner</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-5" style="background: linear-gradient(135deg, var(--primary), var(--secondary));">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8">
                <h2 class="text-white fw-bold mb-4">Ready to help or get help?</h2>
                <p class="text-white-80 mb-4">
                    Join our community of helpful people making a difference one item at a time.
                </p>
                <div class="d-flex flex-wrap justify-content-center gap-3">
                    <a class="btn btn-primary" href="{{ app.user ? path('app_dashboard') : path('app_register') }}">
                        Join free
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
