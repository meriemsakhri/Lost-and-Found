{% extends 'base.html.twig' %}

{% block title %}My Profile • Lost & Found{% endblock %}

{% block body %}
<section class="py-5" style="margin-top: 4rem;">
    <div class="container">
        <div class="row g-4">
            <!-- User info sidebar -->
            <div class="col-lg-4">
                <div class="card shadow-md border-0 rounded-4 mb-4">
                    <div class="card-body text-center">

                        {# Profile picture placeholder #}
                        <div class="mx-auto mb-3"
                            style="
                                width: 110px;
                                height: 110px;
                                border-radius: 50%;
                                background: linear-gradient(135deg, var(--primary), var(--secondary));
                                color: white;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 42px;
                                font-weight: 600;
                            ">
                            {{ user.name ? user.name|first|upper : 'U' }}
                        </div>

                        <h3 class="h5 fw-bold mb-3">My Profile</h3>

                        <p class="mb-1"><strong>Name:</strong> {{ user.name }}</p>
                        <p class="mb-1"><strong>Email:</strong> {{ user.email }}</p>
                        <p class="mb-1"><strong>Phone:</strong> {{ user.phone ?: 'Not provided' }}</p>
                        <p class="mb-1">
                            <strong>Member since:</strong>
                            {{ user.createdAt ? user.createdAt|date('Y-m-d') : 'N/A' }}
                        </p>

                    </div>
                </div>


                <div class="card shadow-md border-0 rounded-4">
                    <div class="card-body">
                        <h3 class="h6 fw-bold mb-3">Summary</h3>
                        <p class="mb-1">
                            <strong>Active items:</strong> {{ activeItems|length }}
                        </p>
                        <p class="mb-0">
                            <strong>Returned items:</strong> {{ returnedItems|length }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- User items -->
            <div class="col-lg-8">
                <!-- Active / not found yet -->
                <div class="mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2 class="h5 fw-bold mb-0">My Active Items (still not found)</h2>
                        <a href="{{ path('app_item_new') }}" class="btn btn-primary btn-sm">
                            + New Lost Item
                        </a>
                    </div>

                    {% if activeItems is empty %}
                        <div class="alert alert-light border">
                            You have no active items. Report a lost item to get started.
                        </div>
                    {% else %}
                        <div class="row g-4">
                            {% for item in activeItems %}
                                <div class="col-md-6">
                                    <div class="card h-100 shadow-sm border-0 rounded-4">
                                        {% if item.image %}
                                            <img src="{{ asset('uploads/' ~ item.image) }}"
                                                 class="card-img-top" alt="{{ item.title }}"
                                                 style="height: 180px; object-fit: cover;">
                                        {% endif %}
                                        <div class="card-body d-flex flex-column">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="badge {{ item.type == 'lost' ? 'badge-lost' : 'badge-found' }}">
                                                    {{ item.type|capitalize }}
                                                </span>
                                                <span class="badge bg-light text-muted">
                                                    {{ item.status|capitalize }}
                                                </span>
                                            </div>

                                            <h5 class="card-title mb-2">{{ item.title }}</h5>
                                            <p class="card-text text-muted small mb-2">
                                                {% if item.description is not null %}
                                                    {% set desc = item.description %}
                                                    {{ desc|length > 80 ? desc|slice(0, 80) ~ '…' : desc }}
                                                {% endif %}
                                            </p>

                                            <p class="card-text small text-muted mb-3">
                                                <strong>Location:</strong> {{ item.location }}<br>
                                                <strong>Date:</strong> {{ item.date ? item.date|date('Y-m-d') : 'N/A' }}
                                            </p>

                                            <div class="mt-auto d-flex flex-wrap gap-2">
                                                <form method="post"
                                                    action="{{ path('app_item_mark_returned', {id: item.id}) }}"
                                                    onsubmit="return confirm('Mark this item as returned?');">
                                                    <button class="btn btn-sm btn-outline-primary" type="submit">
                                                        Mark as returned
                                                    </button>
                                                </form>

                                                <a href="{{ path('app_item_edit', {id: item.id}) }}"
                                                class="btn btn-sm btn-outline-secondary">
                                                    Edit
                                                </a>

                                                <form method="post"
                                                    action="{{ path('app_item_delete', {id: item.id}) }}"
                                                    onsubmit="return confirm('Are you sure you want to delete this item?');">
                                                    <button class="btn btn-sm btn-outline-danger" type="submit">
                                                        Delete
                                                    </button>
                                                </form>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Returned / found items -->
                <div>
                    <h2 class="h5 fw-bold mb-3">My Returned / Found Items</h2>

                    {% if returnedItems is empty %}
                        <div class="alert alert-light border">
                            You have no items marked as returned yet.
                        </div>
                    {% else %}
                        <div class="row g-4">
                            {% for item in returnedItems %}
                                <div class="col-md-6">
                                    <div class="card h-100 shadow-sm border-0 rounded-4">
                                        {% if item.image %}
                                            <img src="{{ asset('uploads/' ~ item.image) }}"
                                                 class="card-img-top" alt="{{ item.title }}"
                                                 style="height: 180px; object-fit: cover;">
                                        {% endif %}
                                        <div class="card-body d-flex flex-column">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="badge {{ item.type == 'lost' ? 'badge-lost' : 'badge-found' }}">
                                                    {{ item.type|capitalize }}
                                                </span>
                                                <span class="badge bg-success text-white">
                                                    Returned
                                                </span>
                                            </div>

                                            <h5 class="card-title mb-2">{{ item.title }}</h5>
                                            <p class="card-text text-muted small mb-2">
                                                {% if item.description is not null %}
                                                    {% set desc = item.description %}
                                                    {{ desc|length > 80 ? desc|slice(0, 80) ~ '…' : desc }}
                                                {% endif %}
                                            </p>

                                            <p class="card-text small text-muted mb-3">
                                                <strong>Location:</strong> {{ item.location }}<br>
                                                <strong>Date:</strong> {{ item.date ? item.date|date('Y-m-d') : 'N/A' }}
                                            </p>

                                            <div class="mt-auto d-flex flex-wrap gap-2">
                                                <form method="post"
                                                    action="{{ path('app_item_mark_active', {id: item.id}) }}"
                                                    onsubmit="return confirm('Move this item back to active?');">
                                                    <button class="btn btn-sm btn-outline-primary" type="submit">
                                                        Mark as lost again
                                                    </button>
                                                </form>

                                                <form method="post"
                                                    action="{{ path('app_item_delete', {id: item.id}) }}"
                                                    onsubmit="return confirm('Are you sure you want to delete this item?');">
                                                    <button class="btn btn-sm btn-outline-danger" type="submit">
                                                        Delete
                                                    </button>
                                                </form>
                                            </div>


                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
